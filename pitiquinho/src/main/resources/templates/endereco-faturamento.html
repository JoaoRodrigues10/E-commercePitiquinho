<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Endereço | Pitiquinho</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://kit.fontawesome.com/a2e0e6ad4b.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="/css/header.css">
    <link rel="stylesheet" href="/css/endereco-faturamento.css">

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
</head>
<body>

<div th:replace="~{fragments/header :: header}"></div>


<main class="container mt-5" style="max-width: 700px;">

    <h2 class="text-center mb-4">
        <i class="fas fa-user-plus me-2"></i> Cadastro de Endereço faturamento
    </h2>

    <form th:action="@{/endereco/cadastro-endereco-faturamento}" method="post" id="enderecoForm" th:object="${endereco}" onsubmit="return validateEnderecoForm()">
        <div class="mb-3">
            <label for="cep" class="form-label">CEP</label>
            <div class="input-group">
                <input type="text" id="cep" class="form-control" name="cep" th:field="*{cep}" placeholder="00000-000" required>
                <button type="button" class="btn btn-primary" onclick="buscarFrete()">Buscar</button>
            </div>
        </div>

        <div class="mb-3">
            <label for="logradouro" class="form-label">Logradouro</label>
            <input type="text" class="form-control" id="logradouro" th:field="*{logradouro}" required>
        </div>

        <div class="row">
            <div class="col-md-4 mb-3">
                <label for="numero" class="form-label">Número</label>
                <input type="text" class="form-control" id="numero" th:field="*{numero}" required>
            </div>
            <div class="col-md-8 mb-3">
                <label for="complemento" class="form-label">Complemento</label>
                <input type="text" class="form-control" id="complemento" th:field="*{complemento}">
            </div>
        </div>

        <div class="mb-3">
            <label for="bairro" class="form-label">Bairro</label>
            <input type="text" class="form-control" id="bairro" th:field="*{bairro}" required>
        </div>

        <div class="row">
            <div class="col-md-8 mb-3">
                <label for="cidade" class="form-label">Cidade</label>
                <input type="text" class="form-control" id="cidade" th:field="*{cidade}" required>
            </div>
            <div class="col-md-4 mb-3">
                <label for="uf" class="form-label">UF</label>
                <input type="text" class="form-control text-uppercase" id="uf" th:field="*{uf}" maxlength="2" required>
            </div>
        </div>

        <input type="hidden" th:name="usuarioId" th:value="${usuario.id}"/>

        <div class="mb-3">
            <label for="tipoEndereco" class="form-label">Tipo de Endereço</label>
            <select class="form-select" id="tipoEndereco" name="tipoEndereco">
                <option value="Faturamento">Faturamento</option>
            </select>
        </div>

        <button type="submit" class="btn btn-primary w-100 mt-3">Salvar Endereço</button>
    </form>
</main>

<script>
    $(document).ready(function(){
        $('#cep').mask('00000-000');
    });

    function buscarFrete() {
        const cep = $("#cep").val().replace(/\D/g, '');
        if (cep.length === 8) {
            fetch(`https://viacep.com.br/ws/${cep}/json/`)
                .then(res => res.json())
                .then(data => {
                    if (!data.erro) {
                        $("#logradouro").val(data.logradouro);
                        $("#bairro").val(data.bairro);
                        $("#cidade").val(data.localidade);
                        $("#uf").val(data.uf);
                        $("#logradouro, #bairro, #cidade, #uf").addClass("is-valid");
                    } else {
                        alert("CEP não encontrado.");
                    }
                })
                .catch(() => alert("Erro ao buscar o CEP."));
        } else {
            alert("CEP inválido. O CEP deve conter 8 dígitos.");
        }
    }

    function validateEnderecoForm() {
        const cep = $("#cep").val().replace(/\D/g, '');
        if (cep.length !== 8) {
            alert("CEP inválido. O CEP deve conter 8 dígitos.");
            return false;
        }
        return true;
    }
</script>
</body>
</html>
